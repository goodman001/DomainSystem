<!DOCTYPE HTML>
<html>
<body>
<script>
	decodeBarcodeFromAreas("10100010110100111011001100110110111101010001101010100111010100001000100100100011101001101100101");
	function decodeBarcodeFromAreas(areas)
	{
		//690123456789
		//build mapping 
		var map0 = {
		//0               
		"0001101":[0,"L"],
		"0100111":[0,"G"],
		"1110010":[0,"R"],
		//"1      ":     ,
		"0011001":[1,"L"],
		"0110011":[1,"G"],
		"1100110":[1,"R"],
		//"2      ":     ,
		"0010011":[2,"L"],
		"0011011":[2,"G"],
		"1101100":[2,"R"],
		//"3      ":     ,
		"0111101":[3,"L"],
		"0100001":[3,"G"],
		"1000010":[3,"R"],
		//"4      ":     ,
		"0100011":[4,"L"],
		"0011101":[4,"G"],
		"1011100":[4,"R"],
		//"5      ":     ,
		"0110001":[5,"L"],
		"0111001":[5,"G"],
		"1001110":[5,"R"],
		//"6      ":     ,
		"0101111":[6,"L"],
		"0000101":[6,"G"],
		"1010000":[6,"R"],
		//"7      ":     ,
		"0111011":[7,"L"],
		"0010001":[7,"G"],
		"1000100":[7,"R"],
		//"8      ":     ,
		"0110111":[8,"L"],
		"0001001":[8,"G"],
		"1001000":[8,"R"],
		//"9      ":     ,
		"0001011":[9,"L"],
		"0010111":[9,"G"],
		"1110100":[9,"R"],	
		}
		//console.log(map0);
		var mapparity={
			"LLLLLL":0,
			"LLGLGG":1,
			"LLGGLG":2,
			"LLGGGL":3,
			"LGLLGG":4,
			"LGGLLG":5,
			"LGGGLL":6,
			"LGLGLG":7,
			"LGLGGL":8,
			"LGGLGL":9
		}
		//console.log(mapparity);
		/*div binary strings*/
		var left = []
		var starts = areas[0] + areas[1] + areas[2];
		var ends = areas[92] + areas[93] + areas[94];
		var msg = "";
		var middle ="";
		var right = []
		var flagleft = 0;
		var flagmid = 0;
		var flagright = 0;
		var tmpcell = "";
		var tmpcell2 = "";
		middle = areas[45] + areas[46] + areas[47] + areas[48] + areas[49];
		for(var i=0;i<areas.length;i++){
			if(i>=3 && i<=45){
				if((i-3)!=0 && (i-3)%7 == 0)
				{
					//tmpcell = tmpcell + areas[i];
					left.push(tmpcell);
					tmpcell = areas[i];
				}else
				{
					tmpcell = tmpcell + areas[i];
				}
			}
			if(i>=50 && i<=92){
				if((i-50)!=0 && (i-50)%7 == 0)
				{
					//tmpcell = tmpcell + areas[i];
					right.push(tmpcell2);
					tmpcell2 = areas[i];
				}else
				{
					tmpcell2 = tmpcell2 + areas[i];
				}
			}
		}
		console.log(right);
		console.log(middle);
		/*cal parity pattern */
		var firststr = "";
		var startnum = -1;
		for(var i=0;i<left.length;i++){
			firststr = firststr + map0[left[i]][1];
		}
		console.log(firststr);
		startnum = mapparity[firststr];
		console.log(startnum);
		/* transfer number*/
		var barcode = [];
		barcode.push(parseInt(startnum));
		for(var i=0;i<left.length;i++)
		{
			if(map0[left[i]][1] != "R"){
				barcode.push(map0[left[i]][0]);
			}
		}
		for(var i=0;i<right.length;i++)
		{
			if(map0[right[i]][1] == "R"){
				barcode.push(map0[right[i]][0]);
			}
		}
		console.log(barcode);
		/*check sum*/
		var checksum = 0;
		for(var i=0;i<barcode.length-1;i++){
			if(i%2 !=0){
				checksum = checksum + barcode[i] *1;
			}else
			{
				checksum = checksum + barcode[i] *3;
			}
		}
		console.log(checksum);
		var level = parseInt(checksum/10)*10;
		var lastnum;
		var checkbool = false;
		if(checksum -level >=5){
			lastnum = level + 10 -checksum;
		}else
		{
			lastnum = checksum - level;
		}
		if(lastnum == barcode[12])
		{
			msg = "check sum successfully";
			checkbool = true;
		}else
		{
			msg = "check sum failed";
		}
		
		
		if(starts != "101")
		{
			msg = "No left guard";
		}else if(middle != "01010")
		{
			msg = "No middle guard";
		}
		else if( ends != "101")
		{
			msg = "No right guard";
		}
		
		var result = {
			barcode: barcode.join(""), 
			message: msg, 
			checksumValid: checkbool
		};
		console.log(result );
		//console.log(areas);
		return result;
	}
</script>

</body>
</html>